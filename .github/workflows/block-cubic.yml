name: Block @cubic mentions

on:
  pull_request:
    types: [opened, edited, synchronize]
  issue_comment:
    types: [created, edited]

jobs:
  check-mentions:
    runs-on: ubuntu-latest
    steps:
      - name: Check for forbidden mentions
        uses: actions/github-script@v7
        with:
          script: |
            const forbidden = /@cubic\b/i;
            const payload = context.payload;

            let texts = [];

            if (payload.pull_request) {
              texts.push(payload.pull_request.title || "");
              texts.push(payload.pull_request.body || "");
            }

            if (payload.comment) {
              texts.push(payload.comment.body || "");
            }

            const hit = texts.find(t => forbidden.test(t));

            if (hit) {
              core.setFailed(
                "âŒ Do not mention @cubic. Use @cubic-dev-ai instead."
              );
            }
